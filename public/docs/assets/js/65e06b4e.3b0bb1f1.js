"use strict";(globalThis.webpackChunklora_mesh_docs=globalThis.webpackChunklora_mesh_docs||[]).push([[774],{1345:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"claude/node-red","title":"Node-RED Configuration","description":"Node-RED flow for Claude AI integration.","source":"@site/docs/claude/node-red.md","sourceDirName":"claude","slug":"/claude/node-red","permalink":"/docs/claude/node-red","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Internal Network","permalink":"/docs/configuration/internal-network"},"next":{"title":"Message Flow","permalink":"/docs/claude/message-flow"}}');var o=s(4848),i=s(8453);const t={sidebar_position:1},l="Node-RED Configuration",d={},a=[{value:"Access Node-RED",id:"access-node-red",level:2},{value:"Flow Overview",id:"flow-overview",level:2},{value:"Nodes Configuration",id:"nodes-configuration",level:2},{value:"1. MQTT In Node",id:"1-mqtt-in-node",level:3},{value:"2. Detect @claude (Function Node)",id:"2-detect-claude-function-node",level:3},{value:"3. Claude API Request (HTTP Request Node)",id:"3-claude-api-request-http-request-node",level:3},{value:"4. Prepare Request (Function Node)",id:"4-prepare-request-function-node",level:3},{value:"5. Process Response (Function Node)",id:"5-process-response-function-node",level:3},{value:"6. Format for MQTT (Function Node)",id:"6-format-for-mqtt-function-node",level:3},{value:"7. MQTT Out Node",id:"7-mqtt-out-node",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Import Flow",id:"import-flow",level:2},{value:"Debugging",id:"debugging",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"node-red-configuration",children:"Node-RED Configuration"})}),"\n",(0,o.jsx)(n.p,{children:"Node-RED flow for Claude AI integration."}),"\n",(0,o.jsx)(n.h2,{id:"access-node-red",children:"Access Node-RED"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"URL"}),": ",(0,o.jsx)(n.a,{href:"http://192.168.100.10:1880",children:"http://192.168.100.10:1880"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Username"}),": admin"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Password"}),": [ask administrator]"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"flow-overview",children:"Flow Overview"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  MQTT In    \u2502\u2500\u2500\u2500\u25ba\u2502 Detect       \u2502\u2500\u2500\u2500\u25ba\u2502 Claude API  \u2502\n\u2502  (receive)  \u2502    \u2502 @claude      \u2502    \u2502 Request     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                              \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  MQTT Out   \u2502\u25c4\u2500\u2500\u2500\u2502 Format       \u2502\u25c4\u2500\u2500\u2500\u2502 Process     \u2502\n\u2502  (send)     \u2502    \u2502 Response     \u2502    \u2502 Response    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(n.h2,{id:"nodes-configuration",children:"Nodes Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"1-mqtt-in-node",children:"1. MQTT In Node"}),"\n",(0,o.jsx)(n.p,{children:"Receives messages from the mesh network."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Settings"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Server: 192.168.68.127:1883"}),"\n",(0,o.jsxs)(n.li,{children:["Topic: ",(0,o.jsx)(n.code,{children:"meshtastic/2/json/LongFast/!69d01ebc"})]}),"\n",(0,o.jsx)(n.li,{children:"QoS: 0"}),"\n",(0,o.jsx)(n.li,{children:"Output: auto-detect"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"2-detect-claude-function-node",children:"2. Detect @claude (Function Node)"}),"\n",(0,o.jsx)(n.p,{children:'Filters messages containing "@claude".'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"var payload = msg.payload;\n\n// Parse if string\nif (typeof payload === 'string') {\n    try {\n        payload = JSON.parse(payload);\n    } catch (e) {\n        return null;\n    }\n}\n\n// Check for text message with @claude\nif (payload.payload && payload.payload.text) {\n    var text = payload.payload.text;\n    if (text.toLowerCase().includes('@claude')) {\n        msg.originalSender = payload.sender;\n        msg.question = text.replace(/@claude/gi, '').trim();\n        return msg;\n    }\n}\nreturn null;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"3-claude-api-request-http-request-node",children:"3. Claude API Request (HTTP Request Node)"}),"\n",(0,o.jsx)(n.p,{children:"Sends request to Claude API."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Settings"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Method: POST"}),"\n",(0,o.jsxs)(n.li,{children:["URL: ",(0,o.jsx)(n.code,{children:"https://api.anthropic.com/v1/messages"})]}),"\n",(0,o.jsxs)(n.li,{children:["Headers:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"x-api-key"}),": [API KEY]"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"anthropic-version"}),": 2023-06-01"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"content-type"}),": application/json"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"4-prepare-request-function-node",children:"4. Prepare Request (Function Node)"}),"\n",(0,o.jsx)(n.p,{children:"Formats the request body for Claude."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'msg.payload = {\n    "model": "claude-sonnet-4-20250514",\n    "max_tokens": 150,\n    "system": "You are a helpful assistant for a rural community. Give brief, clear answers. Maximum 2-3 sentences. Respond in the same language as the question.",\n    "messages": [\n        {\n            "role": "user",\n            "content": msg.question\n        }\n    ]\n};\n\nmsg.headers = {\n    "x-api-key": env.get("CLAUDE_API_KEY"),\n    "anthropic-version": "2023-06-01",\n    "content-type": "application/json"\n};\n\nreturn msg;\n'})}),"\n",(0,o.jsx)(n.h3,{id:"5-process-response-function-node",children:"5. Process Response (Function Node)"}),"\n",(0,o.jsx)(n.p,{children:"Extracts Claude's response."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"if (msg.payload && msg.payload.content && msg.payload.content[0]) {\n    msg.response = msg.payload.content[0].text;\n    return msg;\n}\nreturn null;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"6-format-for-mqtt-function-node",children:"6. Format for MQTT (Function Node)"}),"\n",(0,o.jsx)(n.p,{children:"Prepares message for mesh network."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'// Truncate if too long (LoRa limit ~230 bytes)\nvar response = msg.response;\nif (response.length > 200) {\n    response = response.substring(0, 197) + "...";\n}\n\nmsg.payload = response;\nmsg.topic = "meshtastic/2/json/LongFast/!69d01ebc/sendtext";\n\nreturn msg;\n'})}),"\n",(0,o.jsx)(n.h3,{id:"7-mqtt-out-node",children:"7. MQTT Out Node"}),"\n",(0,o.jsx)(n.p,{children:"Sends response back to mesh."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Settings"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Server: 192.168.68.127:1883"}),"\n",(0,o.jsx)(n.li,{children:"Topic: (set by previous function node)"}),"\n",(0,o.jsx)(n.li,{children:"QoS: 0"}),"\n",(0,o.jsx)(n.li,{children:"Retain: false"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,o.jsx)(n.p,{children:"Set in Node-RED settings:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CLAUDE_API_KEY"}),": Your Anthropic API key"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"import-flow",children:"Import Flow"}),"\n",(0,o.jsx)(n.p,{children:"To import the complete flow:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Open Node-RED"}),"\n",(0,o.jsx)(n.li,{children:"Menu \u2192 Import"}),"\n",(0,o.jsx)(n.li,{children:"Paste the flow JSON"}),"\n",(0,o.jsx)(n.li,{children:"Click Import"}),"\n",(0,o.jsx)(n.li,{children:"Deploy"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,o.jsx)(n.p,{children:"Add debug nodes after each step to see message flow:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"After MQTT In - see raw messages"}),"\n",(0,o.jsx)(n.li,{children:"After Detect @claude - see filtered messages"}),"\n",(0,o.jsx)(n.li,{children:"After Claude API - see responses"}),"\n",(0,o.jsx)(n.li,{children:"After Format - see final output"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var r=s(6540);const o={},i=r.createContext(o);function t(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);